<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¤ãƒ™ãƒ³ãƒˆåæ”¯å ±å‘Šãƒ»ç²¾ç®—æ›¸ä½œæˆã‚¢ãƒ—ãƒª v2.0</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel Standalone -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- html2canvas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        /* é€šå¸¸è¡¨ç¤ºæ™‚ã¯å°åˆ·ã‚¨ãƒªã‚¢ã‚’éè¡¨ç¤º */
        .print-report,
        .print-single-receipt,
        .print-batch-receipts {
            display: none;
        }
        
        /* å°åˆ·ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        @media print {
            /* ç”»é¢ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’éè¡¨ç¤º */
            .screen-only {
                display: none !important;
            }
            
            /* ã™ã¹ã¦ã®å°åˆ·ã‚¨ãƒªã‚¢ã‚’åˆæœŸè¡¨ç¤º */
            .print-area {
                display: block !important;
                visibility: visible !important;
                position: static !important;
                width: 100% !important;
                height: auto !important;
                margin: 0 !important;
                padding: 20px !important;
                background: white !important;
                left: auto !important;
                top: auto !important;
                z-index: auto !important;
            }
            
            /* éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¨ãƒªã‚¢ã®ã¿éè¡¨ç¤º */
            .print-area[data-print-active="false"] {
                display: none !important;
            }
            
            /* ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¨ãƒªã‚¢ã‚’ç¢ºå®Ÿã«è¡¨ç¤º */
            .print-area[data-print-active="true"] {
                display: block !important;
                visibility: visible !important;
            }
            
            @page {
                size: A4 portrait;
                margin: 15mm;
            }
            
            .receipt-batch-page {
                page-break-after: always;
            }
            
            .receipt-batch-page:last-child {
                page-break-after: auto;
            }
            
            * {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
        }
        
        .receipt-template {
            position: fixed;
            left: -9999px;
            width: 600px;
            background: white;
            padding: 40px;
            font-family: 'Yu Mincho', 'Hiragino Mincho Pro', serif;
        }
        
        /* å°åˆ·ã‚¨ãƒªã‚¢ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆç”»é¢ã§ã¯éè¡¨ç¤ºï¼‰ */
        .print-area {
            display: none;
        }
        
        /* å°åˆ·æ™‚ã®ã¿è¡¨ç¤º */
        @media print {
            /* é€šå¸¸ã®ç”»é¢è¦ç´ ã‚’éš ã™ */
            .screen-only {
                display: none !important;
            }
            
            /* ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªå°åˆ·ã‚¨ãƒªã‚¢ã®ã¿è¡¨ç¤º */
            .print-area[data-print-active="true"] {
                display: block !important;
                position: static !important;
                width: 100% !important;
                height: auto !important;
                padding: 0 !important;
                margin: 0 !important;
            }
            
            /* ãã®ä»–ã®å°åˆ·ã‚¨ãƒªã‚¢ã¯éè¡¨ç¤º */
            .print-area[data-print-active="false"] {
                display: none !important;
            }
        }
        
        /* æ¨ªé•·é ˜åæ›¸ï¼ˆA4ç¸¦ãƒ»4äºº/æšï¼‰ */
        .receipt-horizontal {
            width: 100%;
            height: 55mm;
            border: 2px solid #333;
            border-bottom: 1px dashed #666;
            padding: 2mm 4mm;
            background: white;
            font-family: 'Yu Mincho', 'Hiragino Mincho Pro', serif;
            box-sizing: border-box;
            page-break-inside: avoid;
            margin-bottom: 0;
        }
        
        .receipt-horizontal:first-child {
            border-top: 2px solid #333;
        }
        
        .receipt-horizontal:last-child {
            border-bottom: 2px solid #333;
        }
        
        .receipt-horizontal h1 {
            text-align: center;
            font-size: 15px;
            margin-bottom: 2px;
            letter-spacing: 3px;
            font-weight: bold;
        }
        
        .receipt-horizontal .receipt-row {
            border-bottom: 1px solid #333;
            padding: 1.5px 0;
            margin-bottom: 2px;
            font-size: 10px;
            display: flex;
            align-items: center;
        }
        
        .receipt-horizontal .receipt-label {
            display: inline-block;
            width: 60px;
            font-weight: normal;
            flex-shrink: 0;
        }
        
        .receipt-horizontal .receipt-value {
            font-weight: bold;
            flex: 1;
        }
        
        .receipt-horizontal .amount-row {
            font-size: 12px;
            padding: 2px 0;
        }
        
        .receipt-horizontal .footer-section {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            margin-top: 3px;
            font-size: 10px;
        }
        
        .receipt-horizontal .stamp-box-small {
            width: 28px;
            height: 28px;
            border: 1.5px solid #333;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 7px;
            color: #333;
        }
        
        .receipt-horizontal .note-text {
            font-size: 9px;
            margin: 2.5px 0;
        }
        
        /* ä¸€æ‹¬å°åˆ·ç”¨ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆç¸¦ä¸¦ã³ï¼‰ */
        .receipt-batch-page {
            page-break-after: always;
        }
        
        .receipt-batch-page:last-child {
            page-break-after: auto;
        }
    </style>
<!-- Updated: 1765348676 -->
</head>
<body class="bg-gray-50">
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState } = React;
        
        const App = () => {
            // åŸºæœ¬æƒ…å ±ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤è¨­å®šï¼‰
            const [eventName, setEventName] = useState('çµ„åˆã‚¤ãƒ™ãƒ³ãƒˆ');
            const [eventDate, setEventDate] = useState('');
            const [organizer, setOrganizer] = useState('æ¨ªæµœå»ºè¨­ä¸€èˆ¬åŠ´åƒçµ„åˆã€€ä¿åœŸãƒ¶è°·è¥¿æ”¯éƒ¨ã€€æ‹…å½“ï¼šæ¾å´ã€€æ˜‡');
            
            // åå…¥ï¼ˆå‚åŠ è²»ï¼‰
            const [incomes, setIncomes] = useState([]);
            const [newIncome, setNewIncome] = useState({ name: '', amount: '' });
            const [editingIncomeId, setEditingIncomeId] = useState(null);
            const [commonAmount, setCommonAmount] = useState(''); // å…¨å“¡åŒä¸€é‡‘é¡
            
            // æ”¯å‡ºï¼ˆç«‹æ›¿æ‰•ã„ï¼‰
            const [expenses, setExpenses] = useState([]);
            const [newExpense, setNewExpense] = useState({ payee: '', item: 'åº—èˆ—ã¸ã®æ”¯æ‰•ã„', amount: '' });
            const [editingExpenseId, setEditingExpenseId] = useState(null);
            
            // å°åˆ·ãƒ¢ãƒ¼ãƒ‰ç®¡ç†
            const [printMode, setPrintMode] = useState(null); // 'report', 'single', 'batch'
            const [printTargetIncome, setPrintTargetIncome] = useState(null);
            
            // ä¿å­˜ã•ã‚ŒãŸã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§
            const [savedEvents, setSavedEvents] = useState([]);
            
            // åå…¥è¿½åŠ /ç·¨é›†
            const handleAddIncome = () => {
                if (!newIncome.name) {
                    alert('å‚åŠ è€…åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                    return;
                }
                
                // é‡‘é¡ãŒç©ºã®å ´åˆã¯0ã¨ã—ã¦æ‰±ã†
                const amount = newIncome.amount ? parseInt(newIncome.amount) : 0;
                
                if (editingIncomeId) {
                    setIncomes(incomes.map(inc => 
                        inc.id === editingIncomeId 
                            ? { ...inc, name: newIncome.name, amount: amount }
                            : inc
                    ));
                    setEditingIncomeId(null);
                } else {
                    const income = {
                        id: Date.now(),
                        name: newIncome.name,
                        amount: amount,
                        receiptIssued: false
                    };
                    setIncomes([...incomes, income]);
                }
                setNewIncome({ name: '', amount: '' });
            };
            
            // åå…¥ç·¨é›†é–‹å§‹
            const startEditIncome = (income) => {
                setNewIncome({ name: income.name, amount: income.amount.toString() });
                setEditingIncomeId(income.id);
            };
            
            // åå…¥å‰Šé™¤
            const deleteIncome = (id) => {
                if (confirm('å‰Šé™¤ã—ã¦ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) {
                    setIncomes(incomes.filter(inc => inc.id !== id));
                }
            };
            
            // æ”¯å‡ºè¿½åŠ /ç·¨é›†
            const handleAddExpense = () => {
                if (!newExpense.payee || !newExpense.item || !newExpense.amount) {
                    alert('ã™ã¹ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                    return;
                }
                
                if (editingExpenseId) {
                    setExpenses(expenses.map(exp => 
                        exp.id === editingExpenseId 
                            ? { ...exp, payee: newExpense.payee, item: newExpense.item, amount: parseInt(newExpense.amount) }
                            : exp
                    ));
                    setEditingExpenseId(null);
                } else {
                    const expense = {
                        id: Date.now(),
                        payee: newExpense.payee,
                        item: newExpense.item,
                        amount: parseInt(newExpense.amount)
                    };
                    setExpenses([...expenses, expense]);
                }
                setNewExpense({ payee: '', item: 'åº—èˆ—ã¸ã®æ”¯æ‰•ã„', amount: '' });
            };
            
            // æ”¯å‡ºç·¨é›†é–‹å§‹
            const startEditExpense = (expense) => {
                setNewExpense({ payee: expense.payee, item: expense.item, amount: expense.amount.toString() });
                setEditingExpenseId(expense.id);
            };
            
            // æ”¯å‡ºå‰Šé™¤
            const deleteExpense = (id) => {
                if (confirm('å‰Šé™¤ã—ã¦ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) {
                    setExpenses(expenses.filter(exp => exp.id !== id));
                }
            };
            
            // åˆè¨ˆè¨ˆç®—
            const totalIncome = incomes.reduce((sum, inc) => sum + inc.amount, 0);
            const totalExpense = expenses.reduce((sum, exp) => sum + exp.amount, 0);
            const balance = totalExpense - totalIncome;
            
            // â‘  å ±å‘Šæ›¸ãƒ‡ãƒ¼ã‚¿ã‚’PCé€ä¿¡ï¼ˆHTMLãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼‰
            const downloadReportData = () => {
                if (!eventName || !eventDate || !organizer) {
                    alert('åŸºæœ¬æƒ…å ±ã‚’ã™ã¹ã¦å…¥åŠ›ã—ã¦ãã ã•ã„');
                    return;
                }
                
                // HTMLãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆ
                const htmlContent = `<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¤ãƒ™ãƒ³ãƒˆåæ”¯å ±å‘Šæ›¸ - ${eventName}</title>
    <style>
        body {
            font-family: sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            line-height: 1.5;
        }
        h1 {
            text-align: center;
            font-size: 24px;
            margin-bottom: 20px;
            border-bottom: 3px solid #333;
            padding-bottom: 8px;
        }
        .info-section {
            margin-bottom: 20px;
            background: #f5f5f5;
            padding: 12px;
            border-radius: 5px;
        }
        .info-row {
            margin: 5px 0;
            font-size: 14px;
        }
        .info-label {
            font-weight: bold;
            display: inline-block;
            width: 90px;
        }
        h2 {
            font-size: 18px;
            margin-top: 20px;
            margin-bottom: 10px;
            border-left: 5px solid #4a90e2;
            padding-left: 10px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
            font-size: 14px;
        }
        th, td {
            border: 1px solid #333;
            padding: 8px;
            text-align: left;
        }
        th {
            background: #4a90e2;
            color: white;
            font-weight: bold;
        }
        .amount {
            text-align: right;
            font-weight: bold;
        }
        .total-row {
            background: #e3f2fd;
            font-weight: bold;
        }
        .balance-box {
            background: #fff3cd;
            border: 2px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
            text-align: center;
            font-size: 20px;
            font-weight: bold;
            border-radius: 5px;
        }
        .receipt-area {
            margin-top: 30px;
            border: 2px dashed #999;
            padding: 15px;
            min-height: 200px;
        }
        .receipt-title {
            text-align: center;
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .note {
            color: #666;
            font-size: 13px;
        }
        .export-info {
            text-align: right;
            color: #666;
            font-size: 11px;
            margin-top: 20px;
        }
        @media print {
            body {
                margin: 0;
                padding: 15mm;
            }
            @page {
                size: A4 portrait;
                margin: 15mm;
            }
        }
    </style>
</head>
<body>
    <h1>ã‚¤ãƒ™ãƒ³ãƒˆåæ”¯å ±å‘Šæ›¸</h1>
    
    <div class="info-section">
        <div class="info-row">
            <span class="info-label">ã‚¤ãƒ™ãƒ³ãƒˆå:</span>
            <span>${eventName}</span>
        </div>
        <div class="info-row">
            <span class="info-label">é–‹å‚¬æ—¥:</span>
            <span>${eventDate}</span>
        </div>
        <div class="info-row">
            <span class="info-label">ä¸»å‚¬è€…:</span>
            <span>${organizer}</span>
        </div>
    </div>
    
    <h2>ğŸ“Š åå…¥æ˜ç´°</h2>
    <div style="border: 1px solid #333; padding: 15px; background: #f9f9f9; margin-bottom: 20px; border-radius: 5px;">
        <div style="margin-bottom: 10px; line-height: 1.8;">
            ${incomes.map(income => `${income.name}ï¼ˆÂ¥${income.amount.toLocaleString()}ï¼‰`).join('ã€')}
        </div>
        <div style="border-top: 2px solid #333; padding-top: 10px; margin-top: 10px; font-weight: bold; text-align: right;">
            åˆè¨ˆ: Â¥${totalIncome.toLocaleString()}
        </div>
    </div>
    
    <h2>ğŸ’° æ”¯å‡ºæ˜ç´°</h2>
    <table>
        <thead>
            <tr>
                <th>æ”¯æ‰•å…ˆ</th>
                <th>å“ç›®</th>
                <th class="amount">é‡‘é¡</th>
            </tr>
        </thead>
        <tbody>
            ${expenses.map(expense => `
            <tr>
                <td>${expense.payee}</td>
                <td>${expense.item}</td>
                <td class="amount">Â¥${expense.amount.toLocaleString()}</td>
            </tr>
            `).join('')}
            <tr class="total-row">
                <td colspan="2">åˆè¨ˆ</td>
                <td class="amount">Â¥${totalExpense.toLocaleString()}</td>
            </tr>
        </tbody>
    </table>
    
    <div class="balance-box">
        ${balance >= 0 ? 'è«‹æ±‚é¡' : 'è¿”ç´é¡'}: Â¥${Math.abs(balance).toLocaleString()}
    </div>
    
    <div class="receipt-area">
        <div class="receipt-title">é ˜åæ›¸è²¼ä»˜æ¬„</div>
        <p class="note">â€» ç«‹æ›¿æ‰•ã„ã®é ˜åæ›¸ã‚’ã“ã¡ã‚‰ã«è²¼ä»˜ã—ã¦ãã ã•ã„</p>
    </div>
    
    <div class="export-info">
        å‡ºåŠ›æ—¥æ™‚: ${new Date().toLocaleString('ja-JP')}
    </div>
</body>
</html>`;
                
                const blob = new Blob([htmlContent], { type: 'text/html; charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `ã‚¤ãƒ™ãƒ³ãƒˆåæ”¯å ±å‘Šæ›¸_${eventName}_${eventDate}.html`;
                link.click();
                URL.revokeObjectURL(url);
                alert('å ±å‘Šæ›¸ã‚’HTMLãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸã€‚\nPCã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ãã¨ç¾ã—ãæ•´å½¢ã•ã‚ŒãŸå ±å‘Šæ›¸ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚\nãã®ã¾ã¾å°åˆ·ã‚‚å¯èƒ½ã§ã™ã€‚');
            };
            
            // â‘¡ ã‚¤ãƒ™ãƒ³ãƒˆä¿å­˜æ©Ÿèƒ½
            const saveEvent = () => {
                if (!eventName || !eventDate) {
                    alert('ã‚¤ãƒ™ãƒ³ãƒˆåã¨é–‹å‚¬æ—¥ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                    return;
                }
                
                const eventData = {
                    id: Date.now(),
                    eventName,
                    eventDate,
                    organizer,
                    incomes,
                    expenses,
                    savedAt: new Date().toLocaleString('ja-JP')
                };
                
                // localStorageã‹ã‚‰æ—¢å­˜ã®ã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§ã‚’å–å¾—
                const saved = localStorage.getItem('savedEvents');
                const events = saved ? JSON.parse(saved) : [];
                
                // åŒåãƒ»åŒæ—¥ã®ã‚¤ãƒ™ãƒ³ãƒˆãŒã‚ã‚Œã°ä¸Šæ›¸ãç¢ºèª
                const existingIndex = events.findIndex(e => 
                    e.eventName === eventName && e.eventDate === eventDate
                );
                
                if (existingIndex >= 0) {
                    if (!confirm('åŒã˜ã‚¤ãƒ™ãƒ³ãƒˆãŒæ—¢ã«ä¿å­˜ã•ã‚Œã¦ã„ã¾ã™ã€‚ä¸Šæ›¸ãã—ã¾ã™ã‹ï¼Ÿ')) {
                        return;
                    }
                    events[existingIndex] = eventData;
                } else {
                    events.push(eventData);
                }
                
                localStorage.setItem('savedEvents', JSON.stringify(events));
                setSavedEvents(events);
                alert('ã‚¤ãƒ™ãƒ³ãƒˆã‚’ä¿å­˜ã—ã¾ã—ãŸ');
            };
            
            // ã‚¤ãƒ™ãƒ³ãƒˆèª­ã¿è¾¼ã¿
            const loadEvent = (eventData) => {
                if (!confirm(`ã€Œ${eventData.eventName}ã€ã‚’èª­ã¿è¾¼ã¿ã¾ã™ã‹ï¼Ÿç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã¯å¤±ã‚ã‚Œã¾ã™ã€‚`)) {
                    return;
                }
                
                setEventName(eventData.eventName);
                setEventDate(eventData.eventDate);
                setOrganizer(eventData.organizer);
                setIncomes(eventData.incomes || []);
                setExpenses(eventData.expenses || []);
                alert('ã‚¤ãƒ™ãƒ³ãƒˆã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ');
            };
            
            // ã‚¤ãƒ™ãƒ³ãƒˆå‰Šé™¤
            const deleteEvent = (eventId) => {
                if (!confirm('ã“ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                    return;
                }
                
                const saved = localStorage.getItem('savedEvents');
                const events = saved ? JSON.parse(saved) : [];
                const filtered = events.filter(e => e.id !== eventId);
                
                localStorage.setItem('savedEvents', JSON.stringify(filtered));
                setSavedEvents(filtered);
                alert('ã‚¤ãƒ™ãƒ³ãƒˆã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
            };
            
            // ä¿å­˜ã•ã‚ŒãŸã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§ã‚’èª­ã¿è¾¼ã¿ï¼ˆåˆå›ã®ã¿ï¼‰
            React.useEffect(() => {
                const saved = localStorage.getItem('savedEvents');
                if (saved) {
                    setSavedEvents(JSON.parse(saved));
                }
            }, []);
            
            // â‘¢ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¨ãƒªã‚¹ãƒˆã‚¢æ©Ÿèƒ½
            const backupAllData = () => {
                const backupData = {
                    version: '2.0',
                    backupDate: new Date().toLocaleString('ja-JP'),
                    currentEvent: {
                        eventName,
                        eventDate,
                        organizer,
                        incomes,
                        expenses
                    },
                    savedEvents
                };
                
                const jsonStr = JSON.stringify(backupData, null, 2);
                const blob = new Blob([jsonStr], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `ã‚¤ãƒ™ãƒ³ãƒˆåæ”¯ã‚¢ãƒ—ãƒª_ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—_${new Date().toISOString().slice(0,10)}.json`;
                link.click();
                URL.revokeObjectURL(url);
                alert('ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã—ã¾ã—ãŸ');
            };
            
            // ãƒªã‚¹ãƒˆã‚¢ï¼ˆå¾©å…ƒï¼‰
            const restoreData = () => {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    if (!file) return;
                    
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        try {
                            const backupData = JSON.parse(event.target.result);
                            
                            if (!confirm('ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒã—ã¾ã™ã‹ï¼Ÿç¾åœ¨ã®ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ãŒç½®ãæ›ã‚ã‚Šã¾ã™ã€‚')) {
                                return;
                            }
                            
                            // ç¾åœ¨ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒ
                            if (backupData.currentEvent) {
                                setEventName(backupData.currentEvent.eventName || '');
                                setEventDate(backupData.currentEvent.eventDate || '');
                                setOrganizer(backupData.currentEvent.organizer || '');
                                setIncomes(backupData.currentEvent.incomes || []);
                                setExpenses(backupData.currentEvent.expenses || []);
                            }
                            
                            // ä¿å­˜ã•ã‚ŒãŸã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§ã‚’å¾©å…ƒ
                            if (backupData.savedEvents) {
                                localStorage.setItem('savedEvents', JSON.stringify(backupData.savedEvents));
                                setSavedEvents(backupData.savedEvents);
                            }
                            
                            alert('ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒã—ã¾ã—ãŸ');
                        } catch (error) {
                            alert('ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
                        }
                    };
                    reader.readAsText(file);
                };
                input.click();
            };
            
            // é ˜åæ›¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆæ¨ªé•·ãƒ»A4ç¸¦3äººåˆ†ï¼‰
            const ReceiptHorizontal = ({ income }) => (
                <div className="receipt-horizontal">
                    <h1>é ˜åæ›¸</h1>
                    <div className="receipt-row">
                        <span className="receipt-label">å®›å:</span>
                        <span className="receipt-value">{income.name} æ§˜</span>
                    </div>
                    <div className="receipt-row amount-row">
                        <span className="receipt-label">é‡‘é¡:</span>
                        <span className="receipt-value">Â¥{income.amount.toLocaleString()}-</span>
                    </div>
                    <div className="receipt-row">
                        <span className="receipt-label">ä½†ã—æ›¸ã:</span>
                        <span className="receipt-value">{eventName || 'ã‚¤ãƒ™ãƒ³ãƒˆ'} å‚åŠ è²»ã¨ã—ã¦</span>
                    </div>
                    <div className="note-text">
                        ä¸Šè¨˜ã®é‡‘é¡ã‚’æ­£ã«é ˜åã„ãŸã—ã¾ã—ãŸã€‚
                    </div>
                    <div className="footer-section">
                        <div>
                            <div>æ—¥ä»˜: {eventDate || new Date().toLocaleDateString('ja-JP')}</div>
                            <div style={{ marginTop: '10px' }}>ç™ºè¡Œè€…: {organizer || 'å¹¹äº‹'}</div>
                        </div>
                        <div className="stamp-box-small">å°</div>
                    </div>
                </div>
            );
            
            // é ˜åæ›¸ç”Ÿæˆãƒ»å…±æœ‰ï¼ˆç”»åƒåŒ–ï¼‰
            const generateReceipt = async (income) => {
                if (income.receiptIssued && !confirm('æ—¢ã«é ˜åæ›¸ã‚’ç™ºè¡Œæ¸ˆã¿ã§ã™ã€‚å†ç™ºè¡Œã—ã¾ã™ã‹ï¼Ÿ')) {
                    return;
                }
                
                // é ˜åæ›¸HTMLã‚’å‹•çš„ã«ç”Ÿæˆ
                const receiptElement = document.createElement('div');
                receiptElement.className = 'receipt-template';
                receiptElement.innerHTML = `
                    <div style="border: 3px double #333; padding: 30px; background: white;">
                        <h1 style="text-align: center; font-size: 32px; margin-bottom: 30px; letter-spacing: 8px;">é ˜åæ›¸</h1>
                        <div style="margin-bottom: 20px;">
                            <div style="border-bottom: 1px solid #333; padding: 10px 0; font-size: 20px;">
                                <span style="display: inline-block; width: 100px;">å®›å:</span>
                                <span style="font-weight: bold;">${income.name} æ§˜</span>
                            </div>
                        </div>
                        <div style="margin-bottom: 30px;">
                            <div style="border-bottom: 1px solid #333; padding: 10px 0; font-size: 24px;">
                                <span style="display: inline-block; width: 100px;">é‡‘é¡:</span>
                                <span style="font-weight: bold;">Â¥${income.amount.toLocaleString()}-</span>
                            </div>
                        </div>
                        <div style="margin-bottom: 30px;">
                            <div style="border-bottom: 1px solid #333; padding: 10px 0;">
                                <span style="display: inline-block; width: 100px;">ä½†ã—æ›¸ã:</span>
                                <span>${eventName || 'ã‚¤ãƒ™ãƒ³ãƒˆ'} å‚åŠ è²»ã¨ã—ã¦</span>
                            </div>
                        </div>
                        <div style="margin-bottom: 20px;">
                            <div style="padding: 10px 0;">
                                <span>ä¸Šè¨˜ã®é‡‘é¡ã‚’æ­£ã«é ˜åã„ãŸã—ã¾ã—ãŸã€‚</span>
                            </div>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: flex-end; margin-top: 40px;">
                            <div>
                                <div style="margin-bottom: 10px;">æ—¥ä»˜: ${eventDate || new Date().toLocaleDateString('ja-JP')}</div>
                                <div style="margin-top: 20px;">
                                    <div style="margin-bottom: 5px;">ç™ºè¡Œè€…: ${organizer || 'å¹¹äº‹'}</div>
                                </div>
                            </div>
                            <div style="text-align: center;">
                                <div style="width: 60px; height: 60px; border: 2px solid #333; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; font-size: 10px;">å°</div>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(receiptElement);
                
                try {
                    // html2canvasã§ç”»åƒåŒ–
                    const canvas = await html2canvas(receiptElement, {
                        backgroundColor: '#ffffff',
                        scale: 2,
                        logging: false
                    });
                    
                    // Canvasã‚’ç”»åƒã«å¤‰æ›
                    canvas.toBlob(async (blob) => {
                        const file = new File([blob], `é ˜åæ›¸_${income.name}.png`, { type: 'image/png' });
                        
                        // Web Share APIãŒä½¿ç”¨å¯èƒ½ã‹ç¢ºèª
                        if (navigator.share && navigator.canShare && navigator.canShare({ files: [file] })) {
                            try {
                                await navigator.share({
                                    title: 'é ˜åæ›¸',
                                    text: `${income.name}æ§˜ é ˜åæ›¸`,
                                    files: [file]
                                });
                                
                                // å…±æœ‰æˆåŠŸå¾Œã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’æ›´æ–°
                                setIncomes(incomes.map(inc => 
                                    inc.id === income.id ? { ...inc, receiptIssued: true } : inc
                                ));
                                alert('é ˜åæ›¸ã‚’å…±æœ‰ã—ã¾ã—ãŸ');
                            } catch (err) {
                                if (err.name !== 'AbortError') {
                                    console.error('å…±æœ‰ã‚¨ãƒ©ãƒ¼:', err);
                                    downloadImage(canvas, income);
                                }
                            }
                        } else {
                            // Web Share APIéå¯¾å¿œã®å ´åˆã¯ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                            downloadImage(canvas, income);
                        }
                    }, 'image/png');
                    
                } catch (error) {
                    console.error('é ˜åæ›¸ç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error);
                    alert('é ˜åæ›¸ã®ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ');
                } finally {
                    document.body.removeChild(receiptElement);
                }
            };
            
            // ç”»åƒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å‡¦ç†
            const downloadImage = (canvas, income) => {
                const link = document.createElement('a');
                link.download = `é ˜åæ›¸_${income.name}.png`;
                link.href = canvas.toDataURL();
                link.click();
                
                // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¾Œã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’æ›´æ–°
                setIncomes(incomes.map(inc => 
                    inc.id === income.id ? { ...inc, receiptIssued: true } : inc
                ));
                alert('é ˜åæ›¸ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ');
            };
            
            // A4å ±å‘Šæ›¸å°åˆ·
            // A4å ±å‘Šæ›¸å°åˆ·ï¼ˆPCæ¨å¥¨ï¼‰
            const handlePrintReport = () => {
                if (!eventName || !eventDate || !organizer) {
                    alert('åŸºæœ¬æƒ…å ±ã‚’ã™ã¹ã¦å…¥åŠ›ã—ã¦ãã ã•ã„');
                    return;
                }
                
                // å°åˆ·ãƒ¢ãƒ¼ãƒ‰ã‚’è¨­å®š
                setPrintMode('report');
                
                // React ã®å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’å¾…æ©Ÿã—ã¦ã‹ã‚‰å°åˆ·
                setTimeout(() => {
                    window.print();
                    // å°åˆ·ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒé–‰ã˜ã‚‰ã‚ŒãŸå¾Œã«ãƒ¢ãƒ¼ãƒ‰ã‚’ã‚¯ãƒªã‚¢
                    setTimeout(() => {
                        setPrintMode(null);
                    }, 500);
                }, 300);
            };
            
            // å€‹åˆ¥é ˜åæ›¸å°åˆ·ï¼ˆPCæ¨å¥¨ãƒ»å‰Šé™¤äºˆå®šï¼‰
            const handlePrintSingleReceipt = (income) => {
                alert('å€‹åˆ¥é ˜åæ›¸å°åˆ·ã¯PCç’°å¢ƒæ¨å¥¨ã§ã™ã€‚ã‚¹ãƒãƒ›ã§ã¯ã€Œç”»åƒå…±æœ‰ã€ãƒœã‚¿ãƒ³ã‚’ã”åˆ©ç”¨ãã ã•ã„ã€‚');
                // PCå‘ã‘ã®ç°¡æ˜“å°åˆ·
                const printWin = window.open('', '', 'width=800,height=600');
                printWin.document.write('<html><head><title>é ˜åæ›¸</title>');
                printWin.document.write('<style>body{font-family:serif;padding:20mm;}</style></head><body>');
                printWin.document.write('<h1 style="text-align:center;">é ˜åæ›¸</h1>');
                printWin.document.write('<p>å®›å: ' + income.name + ' æ§˜</p>');
                printWin.document.write('<p>é‡‘é¡: Â¥' + income.amount.toLocaleString() + '-</p>');
                printWin.document.write('<p>ä½†ã—æ›¸ã: ' + eventName + ' å‚åŠ è²»ã¨ã—ã¦</p>');
                printWin.document.write('<p>æ—¥ä»˜: ' + eventDate + '</p>');
                printWin.document.write('<p>ç™ºè¡Œè€…: ' + organizer + '</p>');
                printWin.document.write('</body></html>');
                printWin.document.close();
                printWin.print();
                setTimeout(() => printWin.close(), 1000);
                
                // ç™ºè¡Œæ¸ˆã¿ã«æ›´æ–°
                setIncomes(incomes.map(inc => 
                    inc.id === income.id ? { ...inc, receiptIssued: true } : inc
                ));
            };
            
            // ä¸€æ‹¬é ˜åæ›¸å°åˆ·ï¼ˆPCæ¨å¥¨ãƒ»å‰Šé™¤äºˆå®šï¼‰
            const handlePrintBatchReceipts = () => {
                if (incomes.length === 0) {
                    alert('å‚åŠ è€…ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“');
                    return;
                }
                alert('ä¸€æ‹¬å°åˆ·ã¯PCç’°å¢ƒæ¨å¥¨ã§ã™ã€‚ã‚¹ãƒãƒ›ã§ã¯å€‹åˆ¥ã«ã€Œç”»åƒå…±æœ‰ã€ãƒœã‚¿ãƒ³ã‚’ã”åˆ©ç”¨ãã ã•ã„ã€‚');
                // PCå‘ã‘ã®ç°¡æ˜“å°åˆ·
                const printWin = window.open('', '', 'width=800,height=600');
                printWin.document.write('<html><head><title>é ˜åæ›¸ä¸€æ‹¬</title>');
                printWin.document.write('<style>body{font-family:serif;padding:10mm;}.receipt{border:2px solid #000;margin-bottom:10mm;padding:5mm;page-break-inside:avoid;}</style></head><body>');
                incomes.forEach(income => {
                    printWin.document.write('<div class="receipt">');
                    printWin.document.write('<h2 style="text-align:center;">é ˜åæ›¸</h2>');
                    printWin.document.write('<p>å®›å: ' + income.name + ' æ§˜</p>');
                    printWin.document.write('<p>é‡‘é¡: Â¥' + income.amount.toLocaleString() + '-</p>');
                    printWin.document.write('<p>ä½†ã—æ›¸ã: ' + eventName + ' å‚åŠ è²»ã¨ã—ã¦</p>');
                    printWin.document.write('<p>æ—¥ä»˜: ' + eventDate + '</p>');
                    printWin.document.write('<p>ç™ºè¡Œè€…: ' + organizer + '</p>');
                    printWin.document.write('</div>');
                });
                printWin.document.write('</body></html>');
                printWin.document.close();
                printWin.print();
                setTimeout(() => printWin.close(), 1000);
                
                // å…¨å“¡ã‚’ç™ºè¡Œæ¸ˆã¿ã«æ›´æ–°
                setIncomes(incomes.map(inc => ({ ...inc, receiptIssued: true })));
            };
            
            
            // 4äººã”ã¨ã«ãƒšãƒ¼ã‚¸åˆ†å‰²
            const receiptPages = [];
            for (let i = 0; i < incomes.length; i += 4) {
                receiptPages.push(incomes.slice(i, i + 4));
            }
            
            // å…¨å“¡åŒä¸€é‡‘é¡ã‚’è¨­å®š
            const applyCommonAmount = () => {
                if (!commonAmount) {
                    alert('é‡‘é¡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                    return;
                }
                const amount = parseInt(commonAmount);
                if (incomes.length === 0) {
                    alert('å‚åŠ è€…ã‚’å…ˆã«è¿½åŠ ã—ã¦ãã ã•ã„');
                    return;
                }
                if (confirm(`å…¨å“¡ã«Â¥${amount.toLocaleString()}ã‚’è¨­å®šã—ã¾ã™ã‹ï¼Ÿ`)) {
                    setIncomes(incomes.map(inc => ({ ...inc, amount: amount })));
                    alert('å…¨å“¡ã®é‡‘é¡ã‚’æ›´æ–°ã—ã¾ã—ãŸ');
                }
            };
            
            return (
                <>
                    <div className="screen-only">
                        <div className="max-w-6xl mx-auto p-4">
                            {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}
                            <div className="bg-blue-600 text-white p-4 rounded-t-lg">
                                <h1 className="text-2xl font-bold">ğŸ“Š ã‚¤ãƒ™ãƒ³ãƒˆåæ”¯å ±å‘Šãƒ»ç²¾ç®—æ›¸ä½œæˆ</h1>
                            </div>
                            
                            {/* æ–°æ©Ÿèƒ½ãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ */}
                            <div className="bg-gray-100 p-4 border-b-2 border-gray-300">
                                <div className="grid grid-cols-2 md:grid-cols-5 gap-2">
                                    <button
                                        onClick={downloadReportData}
                                        className="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm font-bold"
                                    >
                                        ğŸ“¤ PCé€ä¿¡
                                    </button>
                                    <button
                                        onClick={saveEvent}
                                        className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-bold"
                                    >
                                        ğŸ’¾ ä¿å­˜
                                    </button>
                                    <button
                                        onClick={() => document.getElementById('eventListModal').style.display = 'block'}
                                        className="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-sm font-bold"
                                    >
                                        ğŸ“‚ ä¸€è¦§
                                    </button>
                                    <button
                                        onClick={backupAllData}
                                        className="px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors text-sm font-bold"
                                    >
                                        ğŸ’¾ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
                                    </button>
                                    <button
                                        onClick={restoreData}
                                        className="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm font-bold"
                                    >
                                        ğŸ“¥ å¾©å…ƒ
                                    </button>
                                </div>
                            </div>
                            
                            {/* ã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§ãƒ¢ãƒ¼ãƒ€ãƒ« */}
                            <div id="eventListModal" style={{ display: 'none' }} className="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
                                <div className="bg-white rounded-lg max-w-2xl w-full max-h-96 overflow-auto p-6">
                                    <div className="flex justify-between items-center mb-4">
                                        <h2 className="text-xl font-bold">ä¿å­˜ã•ã‚ŒãŸã‚¤ãƒ™ãƒ³ãƒˆ</h2>
                                        <button
                                            onClick={() => document.getElementById('eventListModal').style.display = 'none'}
                                            className="text-2xl font-bold text-gray-500 hover:text-gray-700"
                                        >
                                            Ã—
                                        </button>
                                    </div>
                                    {savedEvents.length === 0 ? (
                                        <p className="text-gray-500 text-center py-8">ä¿å­˜ã•ã‚ŒãŸã‚¤ãƒ™ãƒ³ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“</p>
                                    ) : (
                                        <div className="space-y-2">
                                            {savedEvents.map(event => (
                                                <div key={event.id} className="border-2 border-gray-200 rounded-lg p-4 flex justify-between items-center">
                                                    <div>
                                                        <div className="font-bold text-lg">{event.eventName}</div>
                                                        <div className="text-sm text-gray-600">é–‹å‚¬æ—¥: {event.eventDate}</div>
                                                        <div className="text-xs text-gray-500">ä¿å­˜æ—¥æ™‚: {event.savedAt}</div>
                                                    </div>
                                                    <div className="flex gap-2">
                                                        <button
                                                            onClick={() => {
                                                                loadEvent(event);
                                                                document.getElementById('eventListModal').style.display = 'none';
                                                            }}
                                                            className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm"
                                                        >
                                                            èª­è¾¼
                                                        </button>
                                                        <button
                                                            onClick={() => deleteEvent(event.id)}
                                                            className="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 text-sm"
                                                        >
                                                            å‰Šé™¤
                                                        </button>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            </div>
                            
                            {/* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */}
                            <div className="bg-white shadow-lg rounded-b-lg p-6">
                                {/* åŸºæœ¬æƒ…å ±å…¥åŠ› */}
                                <div className="mb-6">
                                    <h2 className="text-lg font-bold mb-4">ğŸ“ åŸºæœ¬æƒ…å ±</h2>
                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <input
                                            type="text"
                                            placeholder="ã‚¤ãƒ™ãƒ³ãƒˆå"
                                            value={eventName}
                                            onChange={(e) => setEventName(e.target.value)}
                                            className="px-4 py-3 border-2 rounded-lg focus:outline-none focus:border-blue-500 text-lg"
                                        />
                                        <input
                                            type="date"
                                            value={eventDate}
                                            onChange={(e) => setEventDate(e.target.value)}
                                            className="px-4 py-3 border-2 rounded-lg focus:outline-none focus:border-blue-500 text-lg"
                                        />
                                        <input
                                            type="text"
                                            placeholder="ä¸»å‚¬è€…ï¼ˆç”³è«‹è€…ï¼‰å"
                                            value={organizer}
                                            onChange={(e) => setOrganizer(e.target.value)}
                                            className="px-4 py-3 border-2 rounded-lg focus:outline-none focus:border-blue-500 text-lg"
                                        />
                                    </div>
                                </div>
                                
                                {/* åå…¥ç®¡ç† */}
                                <div className="mb-6">
                                    <h2 className="text-lg font-bold mb-4">ğŸ‘¥ åå…¥ï¼ˆå‚åŠ è²»ï¼‰ç®¡ç†</h2>
                                    <div className="flex flex-col gap-3 mb-4">
                                        <input
                                            type="text"
                                            placeholder="å‚åŠ è€…å"
                                            value={newIncome.name}
                                            onChange={(e) => setNewIncome({ ...newIncome, name: e.target.value })}
                                            className="px-4 py-3 border-2 rounded-lg focus:outline-none focus:border-blue-500 text-lg"
                                        />
                                        <input
                                            type="number"
                                            placeholder="é‡‘é¡ï¼ˆä»»æ„ãƒ»å¾Œã§ä¸€æ‹¬è¨­å®šå¯ï¼‰"
                                            value={newIncome.amount}
                                            onChange={(e) => setNewIncome({ ...newIncome, amount: e.target.value })}
                                            className="px-4 py-3 border-2 rounded-lg focus:outline-none focus:border-blue-500 text-lg"
                                        />
                                        <div className="flex gap-2">
                                            <button
                                                onClick={handleAddIncome}
                                                className="flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-lg font-bold"
                                            >
                                                {editingIncomeId ? 'âœ“ æ›´æ–°' : '+ è¿½åŠ '}
                                            </button>
                                            {editingIncomeId && (
                                                <button
                                                    onClick={() => {
                                                        setEditingIncomeId(null);
                                                        setNewIncome({ name: '', amount: '' });
                                                    }}
                                                    className="px-6 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors text-lg font-bold"
                                                >
                                                    âœ•
                                                </button>
                                            )}
                                        </div>
                                    </div>
                                    
                                    {/* å…¨å“¡åŒä¸€é‡‘é¡è¨­å®š */}
                                    {incomes.length > 0 && (
                                        <div className="mb-4 p-4 bg-yellow-50 border-2 border-yellow-300 rounded-lg">
                                            <h3 className="text-base font-bold mb-2">âš¡ å…¨å“¡åŒä¸€é‡‘é¡è¨­å®š</h3>
                                            <div className="flex gap-2">
                                                <input
                                                    type="number"
                                                    placeholder="é‡‘é¡"
                                                    value={commonAmount}
                                                    onChange={(e) => setCommonAmount(e.target.value)}
                                                    className="flex-1 px-4 py-3 border-2 rounded-lg focus:outline-none focus:border-yellow-500 text-lg"
                                                />
                                                <button
                                                    onClick={applyCommonAmount}
                                                    className="px-6 py-3 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors text-lg font-bold"
                                                >
                                                    ä¸€æ‹¬è¨­å®š
                                                </button>
                                            </div>
                                        </div>
                                    )}
                                    
                                    {/* ä¸€æ‹¬å°åˆ·ãƒœã‚¿ãƒ³ */}
                                    {incomes.length > 0 && (
                                        <div className="mb-4">
                                            <button
                                                onClick={handlePrintBatchReceipts}
                                                className="w-full px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-lg font-bold"
                                            >
                                                ğŸ–¨ï¸ å…¨å“¡åˆ†ã®é ˜åæ›¸ã‚’ä¸€æ‹¬å°åˆ·ï¼ˆA4ç¸¦ãƒ»4äºº/æšï¼‰
                                            </button>
                                        </div>
                                    )}
                                    
                                    {incomes.length > 0 && (
                                        <div className="space-y-2">
                                            {incomes.map(income => (
                                                <div 
                                                    key={income.id} 
                                                    className={`border-2 rounded-lg p-4 ${income.receiptIssued ? 'bg-green-50 border-green-300' : 'border-gray-200'}`}
                                                >
                                                    <div className="flex justify-between items-start mb-2">
                                                        <div className="flex-1">
                                                            <div className="text-lg font-bold">
                                                                {income.name}
                                                                {income.receiptIssued && (
                                                                    <span className="ml-2 text-green-600">âœ“</span>
                                                                )}
                                                            </div>
                                                            <div className={`text-xl font-bold ${income.amount > 0 ? 'text-blue-600' : 'text-gray-400'}`}>
                                                                {income.amount > 0 ? `Â¥${income.amount.toLocaleString()}` : 'é‡‘é¡æœªè¨­å®š'}
                                                            </div>
                                                        </div>
                                                        <div className="flex gap-2">
                                                            <button
                                                                onClick={() => startEditIncome(income)}
                                                                className="px-3 py-2 bg-gray-100 rounded-lg hover:bg-gray-200 text-sm"
                                                            >
                                                                ç·¨é›†
                                                            </button>
                                                            <button
                                                                onClick={() => deleteIncome(income.id)}
                                                                className="px-3 py-2 bg-red-100 text-red-600 rounded-lg hover:bg-red-200 text-sm"
                                                            >
                                                                å‰Šé™¤
                                                            </button>
                                                        </div>
                                                    </div>
                                                    <div className="grid grid-cols-2 gap-2">
                                                        <button
                                                            onClick={() => generateReceipt(income)}
                                                            className={`py-3 rounded-lg text-white text-base font-bold ${
                                                                income.receiptIssued 
                                                                    ? 'bg-green-600 hover:bg-green-700' 
                                                                    : 'bg-purple-600 hover:bg-purple-700'
                                                            } transition-colors`}
                                                        >
                                                            {income.receiptIssued ? 'ğŸ”„ å†å…±æœ‰' : 'ğŸ“± ç”»åƒå…±æœ‰'}
                                                        </button>
                                                        <button
                                                            onClick={() => handlePrintSingleReceipt(income)}
                                                            className="py-3 rounded-lg bg-orange-600 hover:bg-orange-700 text-white text-base font-bold transition-colors"
                                                        >
                                                            ğŸ–¨ï¸ å°åˆ·
                                                        </button>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                                
                                {/* æ”¯å‡ºç®¡ç† */}
                                <div className="mb-6">
                                    <h2 className="text-lg font-bold mb-4">ğŸ›’ æ”¯å‡ºï¼ˆç«‹æ›¿æ‰•ã„ï¼‰ç®¡ç†</h2>
                                    <div className="flex flex-col gap-3 mb-4">
                                        <input
                                            type="text"
                                            placeholder="æ”¯æ‰•å…ˆ"
                                            value={newExpense.payee}
                                            onChange={(e) => setNewExpense({ ...newExpense, payee: e.target.value })}
                                            className="px-4 py-3 border-2 rounded-lg focus:outline-none focus:border-blue-500 text-lg"
                                        />
                                        <input
                                            type="text"
                                            placeholder="å“ç›®"
                                            value={newExpense.item}
                                            onChange={(e) => setNewExpense({ ...newExpense, item: e.target.value })}
                                            className="px-4 py-3 border-2 rounded-lg focus:outline-none focus:border-blue-500 text-lg"
                                        />
                                        <input
                                            type="number"
                                            placeholder="é‡‘é¡"
                                            value={newExpense.amount}
                                            onChange={(e) => setNewExpense({ ...newExpense, amount: e.target.value })}
                                            className="px-4 py-3 border-2 rounded-lg focus:outline-none focus:border-blue-500 text-lg"
                                        />
                                        <div className="flex gap-2">
                                            <button
                                                onClick={handleAddExpense}
                                                className="flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-lg font-bold"
                                            >
                                                {editingExpenseId ? 'âœ“ æ›´æ–°' : '+ è¿½åŠ '}
                                            </button>
                                            {editingExpenseId && (
                                                <button
                                                    onClick={() => {
                                                        setEditingExpenseId(null);
                                                        setNewExpense({ payee: '', item: '', amount: '' });
                                                    }}
                                                    className="px-6 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors text-lg font-bold"
                                                >
                                                    âœ•
                                                </button>
                                            )}
                                        </div>
                                    </div>
                                    
                                    {expenses.length > 0 && (
                                        <div className="space-y-2">
                                            {expenses.map(expense => (
                                                <div 
                                                    key={expense.id} 
                                                    className="border-2 border-gray-200 rounded-lg p-4"
                                                >
                                                    <div className="flex justify-between items-start">
                                                        <div className="flex-1">
                                                            <div className="text-lg font-bold">{expense.payee}</div>
                                                            <div className="text-gray-600">{expense.item}</div>
                                                            <div className="text-xl text-red-600 font-bold">
                                                                Â¥{expense.amount.toLocaleString()}
                                                            </div>
                                                        </div>
                                                        <div className="flex gap-2">
                                                            <button
                                                                onClick={() => startEditExpense(expense)}
                                                                className="px-3 py-2 bg-gray-100 rounded-lg hover:bg-gray-200 text-sm"
                                                            >
                                                                ç·¨é›†
                                                            </button>
                                                            <button
                                                                onClick={() => deleteExpense(expense.id)}
                                                                className="px-3 py-2 bg-red-100 text-red-600 rounded-lg hover:bg-red-200 text-sm"
                                                            >
                                                                å‰Šé™¤
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                                
                                {/* é›†è¨ˆ */}
                                <div className="bg-gray-50 p-4 rounded-lg mb-6">
                                    <h2 className="text-lg font-bold mb-4">ğŸ’° åæ”¯é›†è¨ˆ</h2>
                                    <div className="grid grid-cols-1 gap-4">
                                        <div className="bg-green-100 p-4 rounded-lg">
                                            <div className="text-sm text-gray-600 mb-1">åå…¥åˆè¨ˆ</div>
                                            <div className="text-3xl font-bold text-green-800">Â¥{totalIncome.toLocaleString()}</div>
                                        </div>
                                        <div className="bg-red-100 p-4 rounded-lg">
                                            <div className="text-sm text-gray-600 mb-1">æ”¯å‡ºåˆè¨ˆ</div>
                                            <div className="text-3xl font-bold text-red-800">Â¥{totalExpense.toLocaleString()}</div>
                                        </div>
                                        <div className={`p-4 rounded-lg ${balance >= 0 ? 'bg-blue-100' : 'bg-yellow-100'}`}>
                                            <div className="text-sm text-gray-600 mb-1">{balance >= 0 ? 'è«‹æ±‚é¡' : 'è¿”ç´é¡'}</div>
                                            <div className={`text-3xl font-bold ${balance >= 0 ? 'text-blue-800' : 'text-yellow-800'}`}>
                                                Â¥{Math.abs(balance).toLocaleString()}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                {/* A4å ±å‘Šæ›¸å°åˆ·ãƒœã‚¿ãƒ³ */}
                                <div className="flex justify-center">
                                    <button
                                        onClick={handlePrintReport}
                                        className="w-full px-8 py-4 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-xl font-bold"
                                    >
                                        ğŸ–¨ï¸ A4å ±å‘Šæ›¸ã‚’å°åˆ·
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    {/* A4å ±å‘Šæ›¸å°åˆ·ã‚¨ãƒªã‚¢ */}
                    <div className="print-area" id="print-report" data-print-active={printMode === 'report' ? 'true' : 'false'}>
                        <div style={{ minHeight: '50vh' }}>
                            <h1 style={{ fontSize: '24px', fontWeight: 'bold', textAlign: 'center', marginBottom: '24px' }}>ã‚¤ãƒ™ãƒ³ãƒˆåæ”¯å ±å‘Šæ›¸</h1>
                            
                            <div style={{ marginBottom: '16px' }}>
                                <p style={{ marginBottom: '8px' }}><strong>ã‚¤ãƒ™ãƒ³ãƒˆå:</strong> {eventName}</p>
                                <p style={{ marginBottom: '8px' }}><strong>é–‹å‚¬æ—¥:</strong> {eventDate}</p>
                                <p style={{ marginBottom: '8px' }}><strong>ä¸»å‚¬è€…:</strong> {organizer}</p>
                            </div>
                            
                            <h2 style={{ fontSize: '18px', fontWeight: 'bold', marginBottom: '8px' }}>åå…¥æ˜ç´°</h2>
                            <div style={{ border: '1px solid #000', padding: '8px', marginBottom: '16px', fontSize: '14px' }}>
                                {incomes.map((income, index) => (
                                    <span key={income.id}>
                                        {income.name}(Â¥{income.amount.toLocaleString()})
                                        {index < incomes.length - 1 ? 'ã€' : ''}
                                    </span>
                                ))}
                                <div style={{ marginTop: '8px', fontWeight: 'bold', paddingTop: '8px', borderTop: '1px solid #000' }}>
                                    åˆè¨ˆ: Â¥{totalIncome.toLocaleString()}
                                </div>
                            </div>
                            
                            <h2 style={{ fontSize: '18px', fontWeight: 'bold', marginBottom: '8px' }}>æ”¯å‡ºæ˜ç´°</h2>
                            <table style={{ width: '100%', marginBottom: '16px', fontSize: '14px', borderCollapse: 'collapse' }}>
                                <thead>
                                    <tr>
                                        <th style={{ border: '1px solid #000', padding: '8px', textAlign: 'left' }}>æ”¯æ‰•å…ˆ</th>
                                        <th style={{ border: '1px solid #000', padding: '8px', textAlign: 'left' }}>å“ç›®</th>
                                        <th style={{ border: '1px solid #000', padding: '8px', textAlign: 'right' }}>é‡‘é¡</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {expenses.map(expense => (
                                        <tr key={expense.id}>
                                            <td style={{ border: '1px solid #000', padding: '8px' }}>{expense.payee}</td>
                                            <td style={{ border: '1px solid #000', padding: '8px' }}>{expense.item}</td>
                                            <td style={{ border: '1px solid #000', padding: '8px', textAlign: 'right' }}>Â¥{expense.amount.toLocaleString()}</td>
                                        </tr>
                                    ))}
                                    <tr style={{ fontWeight: 'bold' }}>
                                        <td style={{ border: '1px solid #000', padding: '8px' }} colSpan="2">åˆè¨ˆ</td>
                                        <td style={{ border: '1px solid #000', padding: '8px', textAlign: 'right' }}>Â¥{totalExpense.toLocaleString()}</td>
                                    </tr>
                                </tbody>
                            </table>
                            
                            <div style={{ background: '#f3f4f6', padding: '12px', marginBottom: '16px' }}>
                                <p style={{ fontSize: '18px', fontWeight: 'bold' }}>
                                    {balance >= 0 ? 'è«‹æ±‚é¡' : 'è¿”ç´é¡'}: Â¥{Math.abs(balance).toLocaleString()}
                                </p>
                            </div>
                        </div>
                        
                        <div style={{ height: '45vh', borderTop: '2px dashed #999', paddingTop: '20px' }}>
                            <h2 style={{ textAlign: 'center', fontSize: '18px', fontWeight: 'bold', marginBottom: '16px' }}>é ˜åæ›¸è²¼ä»˜æ¬„</h2>
                            <div style={{ border: '2px solid #333', height: '90%', padding: '10px' }}>
                                <p style={{ fontSize: '14px', color: '#666' }}>â€» ç«‹æ›¿æ‰•ã„ã®é ˜åæ›¸ã‚’ã“ã¡ã‚‰ã«è²¼ä»˜ã—ã¦ãã ã•ã„</p>
                            </div>
                        </div>
                    </div>
                    
                    {/* å€‹åˆ¥é ˜åæ›¸å°åˆ·ã‚¨ãƒªã‚¢ï¼ˆA4ç¸¦ãƒ»1äººï¼‰ */}
                    <div className="print-area" id="print-single" data-print-active={printMode === 'single' ? 'true' : 'false'}>
                        {printTargetIncome && (
                            <div style={{ padding: '8mm 8mm' }}>
                                <ReceiptHorizontal income={printTargetIncome} />
                            </div>
                        )}
                    </div>
                    
                    {/* ä¸€æŠ¬é ˜åæ›¸å°åˆ·ã‚¨ãƒªã‚¢ï¼ˆA4ç¸¦ãƒ»4äºº/æšï¼‰ */}
                    <div className="print-area" id="print-batch" data-print-active={printMode === 'batch' ? 'true' : 'false'}>
                        {receiptPages.map((pageIncomes, pageIndex) => (
                            <div key={pageIndex} className="receipt-batch-page" style={{ padding: '8mm 8mm' }}>
                                {pageIncomes.map((income) => (
                                    <ReceiptHorizontal key={income.id} income={income} />
                                ))}
                            </div>
                        ))}
                    </div>
                </>
            );
        };
        
        // Reactã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>